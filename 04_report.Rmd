---
title: "Data analysis support for TNC-NTRI rangeland management project publication"
author: "Stefan Gehrig, <a href='https://www.estimact.com'>estimact</a>"
date: "`r format(Sys.time(), '%d %B %Y')`"
subtitle: "Version 4"
output: 
  bookdown::html_document2:
    toc: TRUE
    toc_float: TRUE
    toc_collapsed: TRUE
    toc_depth: 4
    number_sections: FALSE
    css: utils/style.css
    includes:
      after_body: utils/footer.html
bibliography: utils/refs.bib
---

<style>
    .table td, .table th {
        font-size: 10px;
    }
</style>

<!-- START OF -->
<br>

***
<!-- DOCUMENT -->

```{r setup, include=FALSE}
library(knitr)
library(kableExtra)
library(tidyverse)
knitr::opts_chunk$set(echo = FALSE)

summary_tier3 <- readRDS("outputs/summary_tier3.rds")
```

## Villages in the sample

Figure \@ref(fig:map) shows a map of the villages included in the analysis.

```{r map, fig.align='center', fig.cap='Map of villages in the sample and Tanzanian administrative boundaries.', out.width="80%"}
include_graphics("outputs/vilmap.png")
```
<br>

## Data processing and description

The raw data can be browsed under <https://stefgehrig.shinyapps.io/TNC-NTRI/>. Starting with those data, all Diagnostic Framework (DF) variables were transformed to be on the same scale from 1 to 3 and to only take integer values for the presented initial analyses. So the procedure was:

 - All variables which had already originally been coded as ordinal with response options 1, 2, 3 were not changed (irrespective of whether the whole range of responses actually occurred in the data)
 - Binary variables (response options 1, 2), were set from 1, 2 to 1, 3 in order to have the same numerical midpoint of their range
 - Continuous variables (e.g., Number of actors, Change in population size, Economic heterogeneity, Mean annual rainfall, ...) were linearly transformed such that the minimum was 1 and the maximum was 3 and then rounded to the nearest integer (1, 2, or 3).

The meaning of code directions is shown in Table \@ref(tab:sds). The coding was such that -- where such a statement could sensibly be made -- higher values refer to better governance/outcomes/conditions for sustainability etc.

<p>Note that some of the Diagnostic Framework (DF) variables show no variation between villages in the sample. See Table \@ref(tab:sds) with means and standard deviations (SD) for each DF variable. Variables which show no variation are highlighted in <span style="color:#FF7F50">orange</span>.</p>

```{r sds}
color.me <- which(summary_tier3$`SD (rescaled)` == 0)
summary_tier3 %>% 
  mutate(across(.cols = c(`Mean (rescaled)`, `SD (rescaled)`), ~round(.x,2))) %>% 
  kable(
    format = "html",
    caption = "Mean and SD for Tier 3 variables and their coding.") %>% 
  kable_styling() %>%
  row_spec(color.me, background = "coral")
```

The highlighted variables with zero variation cannot contribute any information in correlational or explanatory analyses (e.g., for explaining village-level outcomes). So they are removed by default from those analyses.

In Figure \@ref(fig:radar), one radar plot per category of the diagnostic framework (Tier 1) and per village is shown. This descriptive overview allows to get a better sense of the variation we have and which DF variables and categories might be more fruitful to analyze in more depth. The reader is referred to Table \@ref(tab:sds) for interpreting the scores (i.e., what does a low value of 1 [minimum] and a high value of 3 [maximum] mean?).

```{r radar, fig.align='center', fig.cap='Radar plots of scores for all DF variables. Columns are Tier-1 framework categories, rows are villages.', out.width="100%"}
include_graphics("outputs/spiders_separate.png")
```

## Bivariate associations

For an initial exploration, I only looked at specific bivariate associations between variables, driven by some of previously discussed research questions. Average scores for  `Governance Systems (GS)` , `Interactions (I)` and `Outcomes (O)` DF variables were created for each village. Higher scores on `Governance Systems (GS)` and `Interactions (I)` can be interpreted as more developed governance systems and higher scores on `Outcomes (O)` can be interpreted as better commons outcomes (see Table \@ref(tab:sds)).

For two of the villages, it was found in the qualitative data sources that responses about common lands during interviews and focus groups might not have been reliable (see e-mail 2023-05-22 from Monique). These are marked with red circles in all plots that show individual data points (in case qualitative data sources are involved).

The association is shown in Figure \@ref(fig:scattergso).

```{r scattergso, fig.align='center', fig.cap='Scatter plot of village-level averages of scores in Governance Systems (GS), Interactions (I) and Outcomes (O) variables. Pearson correlation coefficient is shown.', out.width="80%"}
include_graphics("outputs/scatter_gs_i_o.png")
```
<br>

A positive association is clearly indicated. We can also look at the correlations of `Governance Systems (GS)` and `Outcomes (O)` variables on a variable-by-variable basis, as in the correlation matrix in Figure \@ref(fig:corrgso).

```{r corrgso, fig.align='center', fig.cap='Pearson correlation coefficients between single Governance Systems (GS) and Outcomes (O) variables.', out.width="70%"}
include_graphics("outputs/corrm_gs_o.png")
```
<br>

The outcome variable `O2.3: Invasives` seems to be least strongly associated with the `Governance Systems (GS)` variables.

A natural follow-up question would be to see how these relationships look after adjusting for rainfall. We would probably expect that we gain certainty about the positive relationship between resource governance and commons outcomes when partialling out the effect of natural variation in climate between villages. Therefore, I residualized the three `Outcomes (O)` variables via a linear model with `ECO1.1: Rainfall patterns` (average of mean annual precipitation 2016-2020 in mm) as a predictor before correlating them with the `Governance Systems (GS)` variables again. Technically, this estimates a semi-partial correlation. Interestingly, the relationships get weaker, as shown in Figure \@ref(fig:corrgso2).

```{r corrgso2, fig.align='center', fig.cap='Pearson correlation coefficients between single Governance Systems (GS) and Outcomes (O) variables, with the effect of rainfall on Outcomes (O) variables partialled out.', out.width="70%"}
include_graphics("outputs/corrm_gs_o_residualizedrain.png")
```
<br>

Digging a bit deeper, this seems to be because rainfall is strongly negatively correlated both with the `Governance Systems (GS)` and `Outcomes (O)` variables (see Figure \@ref(fig:allcorrs)). Therefore, it competes with `Governance Systems (GS)` in explaining variation in `Outcomes (O)` variables.

In a next step, the GIS-based measurements of land use practices are introduced. First, Figure \@ref(fig:gisbased) just shows a scatter plot of the two GIS-based outcome trend measures and two reference lines, which indicate zero change. We see that (i) crop land has increased in all villages (all values $>0$) and that there is generally a negative association: Villages that have experienced stronger increases in crop land have also experienced a stronger reduction in bare ground.

```{r gisbased, fig.align='center', fig.cap='Scatter plot of the two GIS-based outcome trend measures, along with reference lines which indidate no change. Pearson correlation coefficient is shown.', out.width="50%"}
include_graphics("outputs/scatter_gis.png")
```

I estimate a factor change in bare ground and crop land, such that, for example, a value of 1 means that the proportion of village area which is bare ground/crop land did not change from the pre- to the post-period, whereas a value of 1.5 means that the proportion of village area which is bare ground or crop land increased by 50\%. This ratio is log-transformed, maintaining the interpretation that larger values signify an increase in bare ground or crop land, respectively. Positive values hence mean that the proportion of land of the respective type has increased.

There are no clear associations between average score in `Governance Systems (GS)` and the GIS-based measure of change in bare land, but a slight positive tendency between average score in `Governance Systems (GS)` and change in crop land. (Figure \@ref(fig:scattergis)).

```{r scattergis, fig.align='center', fig.cap='Scatter plot of village-level averages of scores in Governance Systems (GS) and GIS-based outcome measures. Pearson correlation coefficient is shown.', out.width="90%"}
include_graphics("outputs/scatter_gs_bare_crop.png")
```

Via a simple linear model, I residualize the GIS-based outcome measure on rainfall, therefore adjusting it for differences in average precipitation between villages. The associations become stronger, as can be seen in Figure \@ref(fig:scattergisres)

```{r scattergisres, fig.align='center', fig.cap='Scatter plot of village-level averages of scores in Governance Systems (GS) and GIS-based outcome measures, adjusted for precipitation. Pearson correlation coefficient is shown.', out.width="90%"}
include_graphics("outputs/scatter_gs_bare_crop_resid.png")
```

How do the GIS-based outcome trend measures relate to the DF variable `O2.1: Commons condition trend`, which is coded from the qualitative data sources? Figure \@ref(fig:boxcommon) shows that there is no obvious association.

```{r boxcommon, fig.align='center', fig.cap='Box plot of the GIS-based outcome trend measures, stratified by village score for the variable O2.1: Commons condition trend.', out.width="70%"}
include_graphics("outputs/boxplots_commen_trend.png")
```

For completeness, I also show all pairwise correlations among all DF variables and GIS-based outcome trend measures in Figure \@ref(fig:allcorrs).

```{r allcorrs, fig.align='center', fig.cap='Pairwise Pearson correlation coefficients among all DF variables and GIS-based outcome trend measures.', out.width="100%"}
include_graphics("outputs/corrm_all_lup.png")
```
<br>

<!-- This analysis so far is, except for the adjustment for rainfall in one of the analyses, purely bivariate, i.e., when looking at one pairwise relationship, we marginalize over the sample distribution in all other variables. Many other types analyses are of course possible where we look at relationships between variables, *conditional on other variables*. So when we get to more sophisticated modelling approaches or multivariate methods, this is exactly what will be done. The exploration so far might, however, give some inspiration in which directions we can or should go in the next steps. -->

<!-- ## Governance Systems (GS) dimensions -->

<!-- The `Governance Systems (GS)` category is among those for which there are (i) most DF variables, (ii) most between-village variation (see Figure \@ref(fig:radar) and (iii) most straightforward to aggregate, because for all DF variables a rather clear directionality from "worse" to "better" commons governance can be devised. It is also probably the most interesting predictor category of commons outcome variables and central to the possible research questions. Therefore, here I add further analyses on its internal structure with multivariate methods. That will also provide a basis for a decision how to aggregate the DF variables into one `Governance Systems (GS)` score. In the previous sections, this was simply done with an unweighted average, i.e., under the rule that each DF variables should contribute independently and equally to the score. -->

<!-- ### PCA -->

<!-- Table X and Figure Y report results from Principal Component Analysis (PCA) -->


<!-- We see that ... -->

<!-- ### MDS -->

<!-- ### Discriminant Analysis -->


<!-- - a word on the proposed Item Response Theory (IRT) model: not really suitable maybe? what is latent here and what is not - ie assumption? -->
<!-- - Then:   Clustering of villages according to avereage score (ie.. on a one-dimensional line) vs multivariately! Are tehre governance "types"`? rather than just high and low  -->
<!-- - correlation with rainfall is weird wa? confounding... -->


<!-- ## Conclusions / Recommendations -->

<!-- <style> -->
<!-- div.blue {background-color:#e6f1fa; border-radius: 5px; padding: 15px;} -->
<!-- </style> -->
<!-- <div class = "blue"> -->

<!-- - This is my first conclusion -->
<!-- - This is my second conclusion -->

<!-- </div> -->

<!-- <!-- END OF --> 
<!-- <br> -->

<!-- *** -->
<!-- <!-- SECTION --> 

<!-- ## References -->
